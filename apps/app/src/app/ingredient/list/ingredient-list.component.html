<form [formGroup]="form" [bindGroupQueryParam]="bindOptions" novalidate>
  <h2>
    Ingrédients
    <button mat-icon-button color="primary" aria-label="Ajouter">
      <mat-icon>add</mat-icon>
    </button>
  </h2>
  <!-- <commycli-loading-spinner [show]="(loading$ | async) === true" diameter="80" page="true"></commycli-loading-spinner> -->
  <div fxLayout="row" fxLayoutAlign="start start">
    <mat-form-field class="text-filter">
      <input
        matInput
        type="text"
        formControlName="searchText"
        placeholder="Rechercher"
        autocomplete="off"
      />
      <button
        mat-button
        *ngIf="form.value.searchText"
        matSuffix
        mat-icon-button
        aria-label="Effacer"
        (click)="clearSearchText()"
      >
        <mat-icon>close</mat-icon>
      </button>
    </mat-form-field>
    <mat-form-field>
      <mat-select placeholder="Type" formControlName="typeId">
        <mat-option>Tous</mat-option>
        <mat-option *ngFor="let type of types$ | async" [value]="type.id">
          {{ type.label }}</mat-option
        >
      </mat-select>
    </mat-form-field>
    <mat-form-field>
      <mat-select placeholder="Season" formControlName="seasonId">
        <mat-option>Toutes</mat-option>
        <mat-option *ngFor="let season of seasons$ | async" [value]="season.id">
          {{ season.label }}</mat-option
        >
      </mat-select>
    </mat-form-field>
    <button mat-icon-button aria-label="Effacer les filtres">
      <mat-icon>highlight_off</mat-icon>
    </button>
  </div>
  <div fxLayout="column" fxLayoutAlign="start start" fxLayoutGap="10px">
    <table
      mat-table
      matSort
      matSortDisableClear="true"
      [dataSource]="dataSource$ | async"
      class="mat-elevation-z8"
    >
      <ng-container matColumnDef="label">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Ingrédient</th>
        <td mat-cell *matCellDef="let element">{{ element.label }}</td>
      </ng-container>
      <ng-container matColumnDef="type">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Type</th>
        <td mat-cell *matCellDef="let element">{{ element.type.label }}</td>
      </ng-container>
      <ng-container matColumnDef="season">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Saisons</th>
        <td mat-cell *matCellDef="let element">
          {{ element.seasons | season }}
        </td>
      </ng-container>
      <ng-container matColumnDef="action">
        <th mat-header-cell *matHeaderCellDef>Actions</th>
        <td mat-cell *matCellDef="let element">
          <button
            mat-icon-button
            color="primary"
            aria-label="Modifier"
            (click)="openDetails(element)"
          >
            <mat-icon>edit</mat-icon>
          </button>
        </td>
      </ng-container>
      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr
        mat-row
        *matRowDef="let row; let i = index; columns: displayedColumns"
        [ngClass]="{ 'even-row': i % 2 === 0 }"
      ></tr>
    </table>
    <mat-paginator
      [pageSizeOptions]="[10, 20, 50]"
      showFirstLastButtons
    ></mat-paginator>
  </div>
</form>
